@page "/movies"
@using Newtonsoft.Json

<PageTitle>Poster</PageTitle>

<h1>Poster</h1>

<div style="display: flex; flex-direction: column; align-items: center;">
    <input type="text" placeholder="Entrez le nom du film que vous voulez rechercher" @bind="Title" style="width: 370px; margin-bottom: 10px;" />

    <button class="btn btn-primary" @onclick="ShowPoster">Show the poster</button>

    @if (!string.IsNullOrEmpty(Url))
    {
        <img src="@Url" alt="Movie Poster" style="max-width: 400px; margin-top: 20px;" />
    }
</div>

@code {
    private string Title;
    private string Url;

    private async Task ShowPoster()
    {
        var apiKey = "c1aaf261";
        var baseUrl = "https://www.omdbapi.com/";
        var url = $"{baseUrl}?apikey={apiKey}&t={Title}";

        using (var httpClient = new HttpClient())
        {
            try
            {
                var response = await httpClient.GetStringAsync(url);

                if (!string.IsNullOrEmpty(response))
                {
                    var responseObject = JsonConvert.DeserializeObject<OmdbResponse>(response);

                    if (responseObject != null && responseObject.Poster != null)
                    {
                        Url = responseObject.Poster;
                    }
                    else
                    {
                        Url = null;
                    }
                }
            }
            catch (Exception ex)
            {
                Url = null;
            }
        }
    }

    private class OmdbResponse
    {
        public string Poster { get; set; }
    }
}
